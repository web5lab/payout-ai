specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # Investment Manager - Main entry point for user investments
  - kind: ethereum
    name: InvestmentManager
    network: lumia-beam
    source:
      address: "0x5785De18a15FeF779BC8E6FC5D702FC9b0fCe0de" # Update with actual deployed address
      abi: InvestmentManager
      startBlock: 3679934
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - User
        - UserInvestment
        - UserClaim
        - UserRefund
        - UserKYBValidation
        - InvestmentEvent
        - RefundEvent
        - GlobalStats
      abis:
        - name: InvestmentManager
          file: ./abis/InvestmentManager.json
      eventHandlers:
        - event: InvestmentRouted(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleInvestmentRouted
        - event: TokensClaimed(indexed address,indexed address,uint256)
          handler: handleTokensClaimed
        - event: RefundClaimed(indexed address,indexed address,indexed address,uint256)
          handler: handleRefundClaimed
        - event: KYBValidatedInvestment(indexed address,indexed address,indexed address,uint256,uint256,bytes32)
          handler: handleKYBValidatedInvestment
      file: ./src/investment-manager.ts

  # Offering Factory - Tracks offering creation
  - kind: ethereum
    name: OfferingFactory
    network: lumia-beam
    source:
      address: "0xD40740fED380B1626B6C05470B17fd1B578662e9" # Update with actual deployed address
      abi: OfferingFactory
      startBlock: 3679934
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - User
        - Offering
        - OfferingDeployment
        - OfferingPerformance
        - GlobalStats
      abis:
        - name: OfferingFactory
          file: ./abis/OfferingFactory.json
        - name: Offering
          file: ./abis/Offering.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: OfferingDeployed(indexed uint256,indexed address,indexed address,address)
          handler: handleOfferingDeployed
      file: ./src/offering-factory.ts

  # Wrapped Token Factory - Tracks wrapped token creation
  - kind: ethereum
    name: WrappedTokenFactory
    network: lumia-beam
    source:
      address: "0x5FBb1b0e115aefa1D733C4CEbB02Df1A8c4f8ad5" # Update with actual deployed address
      abi: WrappedTokenFactory
      startBlock: 3679934
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - User
        - WrappedToken
        - WrappedTokenDeployment
        - GlobalStats
      abis:
        - name: WrappedTokenFactory
          file: ./abis/WrappedTokenFactory.json
        - name: WRAPEDTOKEN
          file: ./abis/WRAPEDTOKEN.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: WrappedTokenDeployed(indexed uint256,indexed address,indexed address,address)
          handler: handleWrappedTokenDeployed
      file: ./src/wrapped-token-factory.ts

templates:
  # Dynamic Offering Contract Template
  - kind: ethereum/contract
    name: Offering
    network: lumia-beam
    source:
      abi: Offering
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - OfferingPerformance
        - UserInvestment
        - RefundEvent
      abis:
        - name: Offering
          file: ./abis/Offering.json
      eventHandlers:
        - event: Invested(indexed address,address,uint256,uint256)
          handler: handleInvested
        - event: Claimed(indexed address,uint256)
          handler: handleClaimed
        - event: SaleClosed(uint256)
          handler: handleSaleClosed
        - event: OfferingFinalized(uint256)
          handler: handleOfferingFinalized
        - event: OfferingCancelled(uint256)
          handler: handleOfferingCancelled
        - event: SoftCapReached(uint256,uint256)
          handler: handleSoftCapReached
      file: ./src/offering.ts

  # Dynamic Wrapped Token Template
  - kind: ethereum/contract
    name: WRAPEDTOKEN
    network: lumia-beam
    source:
      abi: WRAPEDTOKEN
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - User
        - WrappedToken
        - UserWrappedTokenHolding
        - UserPayout
        - UserEmergencyUnlock
        - UserClaim
        - PayoutDistribution
        - PayoutPeriod
        - UserUpcomingPayout
        - PayoutEvent
        - EmergencyEvent
      abis:
        - name: WRAPEDTOKEN
          file: ./abis/WRAPEDTOKEN.json
      eventHandlers:
        - event: InvestmentRegistered(indexed address,uint256,uint256)
          handler: handleInvestmentRegistered
        - event: PayoutDistributed(indexed uint256,uint256,uint256)
          handler: handlePayoutDistributed
        - event: PayoutClaimed(indexed address,uint256,uint256)
          handler: handlePayoutClaimed
        - event: FinalTokensClaimed(indexed address,uint256)
          handler: handleFinalTokensClaimed
        - event: EmergencyUnlockEnabled(uint256)
          handler: handleEmergencyUnlockEnabled
        - event: EmergencyUnlockUsed(indexed address,uint256,uint256)
          handler: handleEmergencyUnlockUsed
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
      file: ./src/wrapped-token.ts